String.prototype.toProperCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};var width=620,height=450,gridSpacing=40,aspect=width/height,min_radius=4,max_radius=20,min_age=35,max_age=57;min_women=10,max_women=90;var xScale=d3.scale.linear().range([50,width]).domain([min_age,max_age]),yScale=d3.scale.linear().range([20,height-20]).domain([100,0]);middle_age=(min_age+max_age)/2;var infobox=d3.select("#infobox"),svg=d3.select("#quadcontainer").append("svg").attr("viewBox","0 0 "+width+" "+height).attr("preserveAspectRatio","xMidYMid").attr("id","quad");svg.append("path").attr("class","grid").attr("d",function(){var e="";for(var t=gridSpacing;t<width;t+=gridSpacing)e+="M"+t+",0 L"+t+","+height;for(var t=gridSpacing;t<height;t+=gridSpacing)e+="M0,"+t+" L"+width+","+t;return e});d3.json("parties.json",function(e,t){function b(){g.transition().duration(800).attr("x",function(e){return e.x}).attr("y",function(e){return e.y})}if(e)return console.warn(e);itemList=t;var n=50,r=["#ca0020","#92c5de","#f4a582","#0571b0"],i=d3.scale.ordinal().range(r),s=d3.svg.arc().outerRadius(n-10).innerRadius(0),o=d3.layout.pie().sort(null);display_infobox=function(e){var t=e.males+e.females;d3.select("#party_info").style("display","block");d3.select("#lbl_party").text(e.party.toProperCase());d3.select("#lbl_total").text(t);d3.select("#lbl_males").text(parseInt(e.males/t*100));d3.select("#lbl_females").text(parseInt(e.females/t*100));d3.select("#lbl_median").text(e.median_age);d3.select("#lbl_young").text(parseInt(e.young/t*100));d3.select("#lbl_middle").text(parseInt(e.middle/t*100));d3.select("#lbl_old").text(parseInt(e.old/t*100));d3.select("#lbl_vold").text(e.vold);d3.selectAll("#youngest_members small").remove();d3.select("#youngest_members").selectAll("small").data(e.youngest).enter().append("small").text(function(e){return e[0].toProperCase()+" ("+e[2]+") | "});d3.selectAll("#oldest_members small").remove();d3.select("#oldest_members").selectAll("small").data(e.oldest).enter().append("small").text(function(e){return e[0].toProperCase()+" ("+e[2]+") | "});var u=function(e,t,u,a){var f=t.length;e.selectAll("svg").remove();var l=e.append("svg").attr("class","pie");l.append("text").attr("class","pie label").attr("text-anchor","middle").attr("y",10).attr("x",45).text(a);l.selectAll("g").data(o(t)).enter().append("g").attr("class","arc").attr("transform","translate("+n+","+(n+5)+")").append("path").attr("d",s).style("fill",function(e,t){return i(t)});legend=l.append("g");legend.selectAll("rect").data(r.slice(0,f)).enter().append("rect").attr("height",10).attr("width",10).attr("y",function(e,t){return t*20+n*2+5}).attr("x",20).style("fill",function(e){return e});legend.selectAll("text").data(u).enter().append("text").attr("class","pie legend").attr("text-anchor","begin").attr("y",function(e,t){return 20*t+n*2+14}).attr("x",40).text(function(e){return e})};u(d3.select("#gender_pie"),[e.males/t,e.females/t],["Men","Women"],"By Gender");u(d3.select("#age_pie"),[e.young/t,e.middle/t,e.old/t,e.vold/t],["< 40","40-59","60-79","80+"],"By Age")};var u=d3.max(itemList,function(e){return e.males+e.females}),a=d3.scale.linear().range([min_radius,max_radius]).domain([0,u]),f=d3.scale.linear().range([.6,.8]).domain([0,u]),l=function(e){return xScale(e.median_age)},c=function(e){var t=e.males+e.females,n=e.females/t*100;return yScale(n)},h=svg.selectAll("g.item").data(itemList,function(e,t){e.total=e.males+e.females;e.r=a(e.total);e.y=c(e);e.x=l(e);return t}).enter().append("g").attr("class","item"),p=d3.svg.axis().tickFormat(function(e){return e+"%"}).scale(yScale).orient("left").ticks(1);svg.append("g").attr("class","yaxis").attr("transform","translate("+xScale(min_age)+", -1)").call(p);svg.append("text").attr("class","y label").attr("text-anchor","end").attr("y",6).attr("transform","translate("+(xScale(min_age)+9)+","+yScale(100)+") rotate(-90)").text("more women →");svg.append("text").attr("class","y label").attr("text-anchor","begin").attr("y",6).attr("transform","translate("+(xScale(min_age)+9)+","+(yScale(0)-5)+") rotate(-90)").text("← fewer women");svg.append("text").attr("class","y label").attr("text-anchor","middle").attr("dy",-5).attr("transform","translate("+xScale(min_age)+", "+yScale(50)+") rotate(-90)").text("% of female candidates");var d=d3.svg.axis().scale(xScale).orient("bottom").ticks(3);svg.append("g").attr("class","xaxis").attr("transform","translate(0, "+yScale(0)+")").call(d);svg.append("line").attr("x1",xScale(min_age)).attr("x2",xScale(max_age)).attr("y1",yScale(50)).attr("y2",yScale(50)).attr("class","axis middle-axis");svg.append("text").attr("class","x label").attr("text-anchor","end").attr("x",xScale(max_age)).attr("y",yScale(50)).attr("dy","-0.5em").text("gender equality line");svg.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",xScale(middle_age)).attr("y",yScale(0)).attr("dy","1.2em").text("median age (years)");svg.append("text").attr("class","x label").attr("text-anchor","end").attr("x",width).attr("x",xScale(max_age)).attr("y",yScale(0)).attr("dy","1.2em").text("older candidates →");svg.append("text").attr("class","x label").attr("text-anchor","begin").attr("y",yScale(0)).attr("x",xScale(min_age)).attr("dy","1.2em").text("← younger candidates");var v=h.append("circle").attr("class","party").attr("r",function(e){return e.r}).attr("cx",function(e){return e.x}).attr("cy",yScale(50)).on("mouseover",display_infobox).on("mousedown",function(e){d3.select(this).classed("clicked",!0);display_infobox(e)}).on("mouseup",function(e){d3.select(this).classed("clicked",!1)}).transition().delay(40).ease("bounce").duration(1e3).attr("cy",function(e){return e.y}),m=JSON.parse(JSON.stringify(itemList)),g=h.append("text").attr("class","text-label").style("font-size",function(e){return f(e.total)+"em"}).attr("y",yScale(50)).attr("x",function(e){return e.x}).attr("dy","1.25em").attr("text-anchor","middle").text(function(e){return e.abbr}).each(function(e,t){m[t].x=e.x;m[t].y=e.y;m[t].name=e.abbr;m[t].width=this.getBBox().width;m[t].height=this.getBBox().height;e.name=e.abbr;e.width=this.getBBox().width;e.height=this.getBBox().height;return t}).on("mouseover",display_infobox).on("mousedown",function(e){d3.select(this).classed("clicked",!0);display_infobox(e)}).on("mouseup",function(e){d3.select(this).classed("clicked",!1)}).transition().delay(40).ease("bounce").duration(1e3).attr("y",function(e){return e.y}),y=d3.labeler().label(itemList).anchor(m).width(width).height(height);y.start(1e3);b()});